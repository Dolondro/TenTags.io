var $jscomp={scope:{},findInternal:function(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var f=a[e];if(b.call(c,f,e,a))return{i:e,v:f}}return{i:-1,v:void 0}}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(c.get||c.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};
$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};
$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,c){return $jscomp.findInternal(this,a,c).v}},"es6-impl","es3");var userSettings={},userID,userFilters=[];
$(function(){userID=$("#userID").val();AddTagVoteListener();AddMenuHandler();AddFilterSearch();GetUserSettings();LoadKeybinds();LoadUserFilters();FilterToggle();Recaptcha();AddInfoBar();HookSubClick();$(".post-full-topbar").click(function(a){console.log(a.currentTarget);$(a.currentTarget).parent().find(".linkImg").toggle()});$(".post").focusin(function(a){$(a.target).children(".post-full-bottombar").show()});$(".post").focusout(function(a){$(a.target).children(".post-full-bottombar").hide()})});
function HookSubClick(){$(".filterbar-subscribe").click(function(a){a.preventDefault();a=$(a.currentTarget);var b=a.children("span");b.hasClass("ti-close")?(b.removeClass("ti-close"),b.addClass("ti-star")):(b.removeClass("ti-star"),b.addClass("ti-close"));a=a.attr("data-filterid");console.log(a);void 0!=a&&$.get("/api/filter/"+a+"/sub",function(a){console.log(a)})})}
function LoadUserFilters(){$("#userID").val()?$.get("/api/user/filters",function(a){console.log(a);0==a.error&&(userFilters=a.data)}):console.log("couldnt get userID")}function AddInfoBar(){$(".infobar-title").click(function(a){$(".infobar-body").toggle();a.preventDefault()})}function Recaptcha(){$(".form-login").focusin(function(){$(".form-login > div").show()});$(".form-login").focusout(function(){$(".form-login > div").hide()});$(".g-recaptcha").prop("disabled",!0)}
function SubmitLogin(){console.log("done");document.getElementById("register").submit()}
function FilterToggle(){var a=$(".filter-bar"),b=$(".hamburger");b.click(function(c){c.stopPropagation();console.log("this");b.toggleClass("is-active");c=a.css("display");"flex"===c||"table-cell"===c?(a.css("display","none"),console.log("hiding filtebar")):481>$(window).width()?(a.css("display","flex"),a.focus(),a.focusout(function(b){console.log(b);$(b.relatedTarget).parents(".filter-bar").length?console.log("thisjiuh"):(console.log("nope"),a.hide())})):a.css("display","table-cell")});$(".toggle-filterstyle").click(function(a){$(".filter-styles").toggle();
a.preventDefault()})}function Upvote(a){var b=$(":focus");a.preventDefault();b.length&&VotePost(b,"up")}function Downvote(a){var b=$(":focus");a.preventDefault();b.length&&(console.log(2),VotePost(b,"down"))}function OpenLink(a){if($(":focus").find(".post-link").length){var b=$(":focus").find(".post-link").attr("href");console.log(b);window.open(b,"_blank");a.preventDefault()}}
function OpenComments(a){if($(":focus").find(".comment-link").length){var b=document.location.origin+$(":focus").find(".comment-link").attr("href");console.log(b);window.open(b,"_blank");a.preventDefault()}}function MoveFocus(a){a.preventDefault();var b=$(":focus");if(b.hasClass("post")){var c;"ArrowUp"==a.key?c=b.prev():"ArrowDown"==a.key?c=b.next():console.log(a.key);c.length&&c.focus()}}
function LoadKeybinds(){Mousetrap.bind("up",MoveFocus);Mousetrap.bind("down",MoveFocus);Mousetrap.bind("enter",OpenLink);Mousetrap.bind("space",OpenComments);Mousetrap.bind("right",Upvote);Mousetrap.bind("left",Downvote);$("#posts").children().first().focus()}userFilters={};function GetUserSettings(){var a=$("#userID").val();a&&$.getJSON("/api/user/"+a+"/settings",function(a){"success"==a.status&&(userSettings=a.data)})}
function ChangeFocus(a){index+=a;a=$("#posts").children().length-1;index=Math.max(index,0);index=Math.min(index,a);$("#posts").children().eq(index).focus()}function UserHasFilter(a){var b=null;$.each(userFilters,function(c,d){d.id==a&&(b=!0)});return b}
function UpdateSidebar(a){var b=$(".filterbar-results");b.empty();$.each(a.data,function(a,d){var c="\n    <ul class = 'filterbarelement'>\n      <a href ='/f/"+d.id+"/sub' class = 'filterbar-subscribe' data-filterid=\""+d.id+'"> ';console.log(UserHasFilter(d.id));1==UserHasFilter(d.id)?(console.log("minus"),c+='<span class="ti-minus"></span>'):(console.log("plus"),c+='<span class="ti-plus"></span>');c+="\n      <a href ='/f/"+d.name+"' class='filterbar-link'>\n        <span > "+d.name+"</span>\n      </a>\n    </ul>";
b.append(c)});HookSubClick()}function AddFilterSearch(){$(".filter-search-form").submit(function(a){a.preventDefault()});$("#filterSearch").on("input",function(a){a.preventDefault();clearTimeout($(this).data("timeout"));var b=this;$(this).data("timeout",setTimeout(function(){console.log("searching");b.value.trim()?$.get("/api/filter/search/"+b.value,{search:b.value},UpdateSidebar):$.get("/api/user/filters",{search:b.value},UpdateSidebar)},200))})}
function AddMenuHandler(){$(".settings-link").click(function(a){var b=$(".settings-menu");b.toggle();b.focus();b.focusout(function(a){$(a.relatedTarget).parents(".settings-menu").length||b.hide()});a.preventDefault()})}
function AddTagVoteListener(){$(".upvote").click(function(a){a.preventDefault();a=$(this).parent().find(".tagcount");a.text(Number(a.text())+1);a=$(this).parent().data("id");var b=$("#postID").val();$.get("/post/upvotetag/"+a+"/"+b,function(a){console.log(a)})});$(".downvote").click(function(a){a.preventDefault();a=$(this).parent().find(".tagcount");a.text(Number(a.text())-1);a=$(this).parent().data("id");var b=$("#postID").val();$.get("/post/downvotetag/"+a+"/"+b,function(a){console.log(a)})})};
