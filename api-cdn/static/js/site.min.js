var $jscomp={scope:{},findInternal:function(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var f=a[e];if(b.call(c,f,e,a))return{i:e,v:f}}return{i:-1,v:void 0}}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(c.get||c.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};
$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};
$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,c){return $jscomp.findInternal(this,a,c).v}},"es6-impl","es3");var userSettings={},newPosts={},maxPosts=10,seenPosts=[],userID,postIndex=0;$(function(){userID=$("#userID").val();AddTagVoteListener();AddPostVoteListener();AddMenuHandler();AddFilterSearch();GetUserSettings();LoadKeybinds();LoadNewPosts();AddToSeenPosts();AddFilterHandler();Drag2();FilterToggle();Recaptcha();AddInfoBar()});
function AddInfoBar(){$(".infobar-title").click(function(a){$(".infobar-body").toggle();a.preventDefault()})}function Recaptcha(){$(".form-login").focusin(function(){$(".form-login > div").show()});$(".form-login").focusout(function(){$(".form-login > div").hide()})}function Drag2(){console.log("this");interact(".post").draggable({inertia:!0,onmove:dragMoveListener,onend:onEndListener,onstart:onStartListener,axis:"x"})}
function onStartListener(a){$(a.target).children("a").click(function(a){a.preventDefault()});console.log("this started")}
function onEndListener(a){var b=a.target,c=(parseFloat(b.getAttribute("data-x"))||0)+a.dx;console.log(c);$(a.target).children("a").off("click");a.preventDefault();console.log(a.dx);0>=a.dx&&-200>a.dx?(console.log("voting down"),VotePost(a.target,"down")):0<a.dx&&200<a.dx&&(console.log("voting up"),VotePost(a.target,"up"));b.style.webkitTransform=b.style.transform="translate(0px, 0px)";b.setAttribute("data-x",0);b.setAttribute("data-y",0)}
function dragMoveListener(a){var b=a.target;a=(parseFloat(b.getAttribute("data-x"))||0)+a.dx;y=0;b.style.webkitTransform=b.style.transform="translate("+a+"px, "+y+"px)";b.setAttribute("data-x",a);b.setAttribute("data-y",y)}function SubmitLogin(){console.log("done");document.getElementById("register").submit()}
function FilterToggle(){var a=$(".hamburger");a.on("click",function(b){a.toggleClass("is-active");console.log("that");$(".filter-bar").toggle()});$(".toggle-filterstyle").click(function(a){$(".filter-styles").toggle();a.preventDefault()})}function Upvote(a){a=$(":focus");a.length&&VotePost(a,"up")}function Downvote(a){a=$(":focus");console.log(a);a.length&&(console.log(2),VotePost(a,"down"))}
function AddPostVoteListener(){$(".post-upvote").click(function(a){a.preventDefault();VotePost($(this).parent().parent(),"up")});$(".post-downvote").click(function(a){a.preventDefault();VotePost($(this).parent().parent(),"down")})}
function VotePost(a,b){var c=$(a).children(".postID").val(),d=$(a).children(".postHash").val();console.log(c,d);"1"==userSettings.hideVotedPosts&&(-1==$.inArray(c,seenPosts)&&seenPosts.push(c),LoadMorePosts($(a).parents(".post")),$(a).hide(0,function(){var b=$(a).next();b.length&&b.focus();$(a).remove()}));"up"==b?($(a).css("background-color","#b3ffb3"),c="/api/post/"+c+"/upvote?hash="+d):($(a).css("background-color","#ffb3b3"),c="/api/post/"+c+"/downvote?hash="+d);$(a).find(".post-upvote").hide();
$(a).find(".post-downvote").hide();$.get(c,function(a){})}function AddFilterHandler(){}function AddToSeenPosts(){$.each($("#posts").children(),function(a,b){var c=$(b).find(".postID").val();seenPosts.push(c)})}function LoadNewPosts(a,b){$.getJSON("/api/frontpage?startat=1&endat=100",function(a){console.log(a);"success"==a.status&&(console.log(a.data),newPosts=a.data,"undefined"==a.data&&(newPosts=[]),console.log(newPosts.length+" new posts got from server"))})}
function OpenLink(a){if($(":focus").find(".post-link").length){var b=$(":focus").find(".post-link").attr("href");console.log(b);window.open(b,"_blank");a.preventDefault()}}function OpenComments(a){if($(":focus").find(".comment-link").length){var b=document.location.origin+$(":focus").find(".comment-link").attr("href");console.log(b);window.open(b,"_blank");a.preventDefault()}}
function MoveFocus(a){a.preventDefault();var b=$(":focus");if(b.hasClass("post")){var c;"ArrowUp"==a.key?c=b.prev():"ArrowDown"==a.key?c=b.next():console.log(a.key);c.length&&c.focus()}}function LoadKeybinds(){Mousetrap.bind("up",MoveFocus);Mousetrap.bind("down",MoveFocus);Mousetrap.bind("enter",OpenLink);Mousetrap.bind("space",OpenComments);Mousetrap.bind("right",Upvote);Mousetrap.bind("left",Downvote);$("#posts").children().first().focus()}var userFilters={};
function GetUserSettings(){var a=$("#userID").val();a&&$.getJSON("/api/user/"+a+"/settings",function(a){"success"==a.status&&(userSettings=a.data)})}function ChangeFocus(a){index+=a;a=$("#posts").children().length-1;index=Math.max(index,0);index=Math.min(index,a);$("#posts").children().eq(index).focus()}
function UpdateSidebar(a){var b=$(".filterContainer");b.empty();$.each(a.data,function(a,d){console.log(a,d);b.append("     <ul>       <a href ='/f/"+d.name+"' class='filterbarelement'>         <span > "+d.name+"</span>       </a>     </ul>     ")})}
function AddFilterSearch(){$(".filter-search-form").submit(function(a){a.preventDefault()});$("#filterSearch").on("input",function(a){a.preventDefault();clearTimeout($(this).data("timeout"));var b=this;$(this).data("timeout",setTimeout(function(){console.log("searching");b.value.trim()?$.get("/api/filter/search/"+b.value,{search:b.value},UpdateSidebar):$.get("/api/user/filters",{search:b.value},UpdateSidebar)},200))})}
function AddMenuHandler(){$(".settings-link a").click(function(a){$(".settings-menu").toggle();$(".settings-menu").focus();a.preventDefault()})}function GetFreshPost(){for(var a=newPosts.shift();-1!=$.inArray(a.id,seenPosts);)if(a=newPosts.shift(),void 0==a&&(postIndex+=100,LoadNewPosts(postIndex,postIndex+100),a=newPosts.shift(),void 0==a))return;return a}
function LoadMorePosts(a){a=a.clone();$(a).slideDown("fast");var b=GetFreshPost();if(null!=b){a.find(".postID").val(b.id);a.find(".post-link").text(b.title);var c;c=null==b.link?"/post/"+b.shortURL||b.id:b.link;a.find(".comment-link").attr("href",c);a.find(".comment-link").text(b.commentCount+" comments");null==b.userHasVoted?(a.find(".postUpvote").show(),a.find(".postDownvote").show()):(a.find(".postUpvote").hide(),a.find(".postDownvote").hide());var d=a.find(".filter-icon");$.each(d,function(a,
b){$(b).hide()});$.each(b.filters,function(a,b){var c=$(d[a]);c.text(b.name);c.attr("href","/f/"+b.name);c.show()});$("#posts").append(a)}}
function AddTagVoteListener(){$(".upvote").click(function(){var a=$(this).parent().find(".tagcount");a.text(Number(a.text())+1);var a=$(this).parent().data("id"),b=$("#postID").val();$.get("/post/upvotetag/"+a+"/"+b,function(a){console.log(a)})});$(".downvote").click(function(){var a=$(this).parent().find(".tagcount");a.text(Number(a.text())-1);var a=$(this).parent().data("id"),b=$("#postID").val();$.get("/post/downvotetag/"+a+"/"+b,function(a){console.log(a)})})};
