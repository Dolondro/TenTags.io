var $jscomp={scope:{},findInternal:function(a,c,b){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var f=a[e];if(c.call(b,f,e,a))return{i:e,v:f}}return{i:-1,v:void 0}}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,c,b){if(b.get||b.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[c]=b.value)};
$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(a,c,b,d){if(c){b=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in b||(b[e]={});b=b[e]}a=a[a.length-1];d=b[a];c=c(d);c!=d&&null!=c&&$jscomp.defineProperty(b,a,{configurable:!0,writable:!0,value:c})}};
$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,b){return $jscomp.findInternal(this,a,b).v}},"es6-impl","es3");var knownFilters=[];Dropzone.autoDiscover=!1;
$(function(){$("#image-dropzone").dropzone({maxFiles:20,url:"/api/i/",thumbnailWidth:300,thumbnailHeight:200,previewTemplate:$("#template-preview").html(),success:function(a,c){console.log(c);console.log(a.previewElement);$(a.previewElement).data("fileID",c.data)}});$("#image-dropzone").sortable({items:".dz-preview",cursor:"move",opacity:.5,containment:"#image-dropzone",distance:20,tolerance:"pointer",dictDefaultMessage:"test test"});$("#selectedtags").selectize({plugins:["remove_button"],delimiter:" ",
persist:!1,create:function(a){return{value:a,text:a}}});AddNewPostFilterSearch();OverrideSubmit()});function GetPostFilters(a,c){console.log("this");$.get("/api/filter/search/"+a,{search:a},function(a){console.log(a);c({})})}
function AddOptions(a){var c=$("#selectedfilters")[0].selectize;$.get("/api/filter/search/"+a,{search:a},function(a){0==a.error&&($.each(a.data,function(a,b){knownFilters.push(b);console.log("adding: ",b.name);c.addOption({text:b.name,value:b.name})}),c.refreshOptions(),console.log(a))})}
function FilterSelected(a,c){console.log(a);console.log(c);var b=$.grep(knownFilters,function(b,c){console.log(b,c);return b.name==a})[0],d=$("#selectedtags")[0].selectize;$.each(b.requiredTagNames,function(a,b){d.addOption({text:b,value:b});d.refreshOptions();d.addItem(b);console.log("adding ",b," to tagSelect")});d.refreshOptions();UpdateFilterStyles();OverrideSubmit()}
function SetBanned(a,c){console.log("this ",a,c);var b=$("#selectedfilters")[0].selectize,d=$("#selectedtags")[0].selectize,b=b.getItem(a),d=d.getItem(c);$(d).addClass("banned");$(b).addClass("banned")}
function OverrideSubmit(){$("#submitButton").click(function(a){a.preventDefault();a=$("#selectedtags").val();var c=[];$(".dz-complete").each(function(){var a=$(this).data("fileID"),d=$(this).find(".form-input").first().val();console.log(a);console.log(d);c.push({id:a,text:d})});a={selectedtags:JSON.stringify(a),posttitle:$("#posttitle").val(),postlink:$("#postlink").val(),posttext:$("#posttext").val(),postimages:JSON.stringify(c)};$.ajax({type:"POST",url:"/p/new",data:a,success:function(a){console.log("this "+
a);console.log(a);a.id&&window.location.assign("/p/"+a.id);$("#submitError").html(a)},error:function(a){console.log("that");console.log(a.responseText)},dataType:"json"})})}
function UpdateFilterStyles(){var a=$("#selectedfilters")[0].selectize,c=$("#selectedtags")[0].selectize,b=a.getValue().split(" "),d=c.getValue().split(" ");$.each(b,function(b,c){var e=$.grep(knownFilters,function(a,b){return a.name==c})[0];a.getItem(c).removeClass("banned");void 0===e&&console.log("couldnt find filter: ",c);$.each(e.bannedTagNames,function(a,b){$.each(d,function(a,d){b==d&&SetBanned(c,d)})})})}
function AddNewPostFilterSearch(){$("#selectedfilters").selectize({plugins:["remove_button"],delimiter:" ",persist:!1,create:!1,onType:AddOptions,onItemAdd:FilterSelected})}function UpdateFilterSelect(a){var c=$("#filterselect");$.each(a.data,function(a,d){knownFilters.push(d);c.append('<option value="'+d.name+'">'+d.name+"</option>");c.trigger("chosen:updated")})};
