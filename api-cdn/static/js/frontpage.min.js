var $jscomp={scope:{},findInternal:function(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var f=a[e];if(b.call(c,f,e,a))return{i:e,v:f}}return{i:-1,v:void 0}}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(c.get||c.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};
$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};
$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,c){return $jscomp.findInternal(this,a,c).v}},"es6-impl","es3");var index=0,hasFocus=!1,hidden={},newPosts=[],maxPosts=10,seenPosts=[],postIndex=10,list_empty;
$(function(){$(".post-controls").hide();HookSave();$(".post").focus(function(){var a=$(this).find(".post-controls");$(a).show()});$(".post").focusout(function(){var a=$(this).find(".post-controls");$(a).hide()});AddPostVoteListener();LoadNewPosts();AddToSeenPosts();AddFilterHandler();Drag2()});
function HookSave(){$(".post-save-button").click(function(a){a.preventDefault();a.stopPropagation();$(a.currentTarget).children().toggleClass("ti-star");$(a.currentTarget).children().toggleClass("ti-trash");a=$(a.currentTarget).attr("href");$.get(a,function(a){console.log(a)})})}function onStartListener(a){$(a.target).children("a").click(function(a){a.preventDefault()});console.log("this started")}
function dragMoveListener(a){var b=a.target;a=(parseFloat(b.getAttribute("data-x"))||0)+a.dx;y=0;b.style.webkitTransform=b.style.transform="translate("+a+"px, "+y+"px)";b.setAttribute("data-x",a);b.setAttribute("data-y",y)}
function onEndListener(a){var b=a.target,c=(parseFloat(b.getAttribute("data-x"))||0)+a.dx;console.log(c);$(a.target).children("a").off("click");a.preventDefault();console.log(a.dx);0>=a.dx&&-200>a.dx?(console.log("voting down"),VotePost(a.target,"down")):0<a.dx&&200<a.dx&&(console.log("voting up"),VotePost(a.target,"up"));b.style.webkitTransform=b.style.transform="translate(0px, 0px)";b.setAttribute("data-x",0);b.setAttribute("data-y",0)}
function AddInfinite(){$(window).scroll(function(){if($(window).scrollTop()+$(window).height()>=$(document).height()-50)for(var a=1;1>=a;a++)LoadMorePosts($(".posts").children().first())})}function Drag2(){console.log("this");interact(".post").draggable({inertia:!0,onmove:dragMoveListener,onend:onEndListener,onstart:onStartListener,axis:"x"})}function AddFilterHandler(){}function AddToSeenPosts(){$.each($("#posts").children(),function(a,b){var c=$(b).find(".postID").val();seenPosts.push(c)})}
function AddPostVoteListener(){$(".post-upvote, .upvoteButton").click(function(a){a.preventDefault();$(".upvoteButton, .downvoteButton").hide();VotePost($(this).parents(".post"),"up")});$(".post-downvote, .downvoteButton").click(function(a){a.preventDefault();$(".upvoteButton, .downvoteButton").hide();VotePost($(this).parents(".post"),"down")})}
function VotePost(a,b){var c=$(a).children(".postID").val(),d=$(a).children(".postHash").val();console.log(c,d);1==userSettings.hideVotedPosts&&(-1==$.inArray(c,seenPosts)&&seenPosts.push(c),LoadMorePosts($(a)),$(a).hide(0,function(){var b=$(a).next();b.length&&b.focus();$(a).remove()}));c="up"==b?"/api/post/"+c+"/upvote?hash="+d:"/api/post/"+c+"/downvote?hash="+d;$(a).find(".post-upvote").addClass("disable-vote");$(a).find(".post-downvote").addClass("disable-vote");$.get(c,function(a){})}
function LoadNewPosts(a){list_empty||$.getJSON("/api/frontpage?startAt="+(void 0===a?10:a)+"&range=100",function(a){console.log(a);if("success"==a.status){a.data.length?console.log("got data"):console.log("no data");var b=0;$.each(a.data,function(a,c){newPosts.push(c);b++});100>b&&(list_empty=!0)}})}
function GetFreshPost(){10>newPosts.length&&(postIndex+=100,LoadNewPosts(postIndex));var a=newPosts.shift();if(void 0!=a){for(;-1!=$.inArray(a.id,seenPosts);)if(a=newPosts.shift(),void 0==a)return;return a}}
function LoadMorePosts(a){a=a.clone();var b=GetFreshPost();if(null==b)console.log("no post");else{a.find(".postID").val(b.id);a.find(".post-link").text(b.title);var c;c=null==b.link?"/p/"+b.shortURL||b.id:b.link;null==b.link&&null==b.bbID?(a.find(".post-icon").attr("src","/static/icons/self.svg"),a.find(".linkImg").hide()):(a.find(".post-icon").attr("src","/icon/"+b.id),a.find(".linkImg").attr("src","/icon/"+b.id),console.log("adding "+c+" to linkImg parent"),a.find(".linkImg").parent().attr("href",
c),a.find(".linkImg").show());b.text&&a.find(".postelement-text").text(b.text.substring(0,300));a.find(".post-link").attr("href","/p/"+b.shortURL||b.id);a.find(".comment-link").attr("href","/p/"+b.shortURL||b.id);a.find(".comment-link").text(b.commentCount+" comments");null==b.userHasVoted?(a.find(".postUpvote").show(),a.find(".postDownvote").show()):(a.find(".postUpvote").hide(),a.find(".postDownvote").hide());var d=a.find(".filter-icon");$.each(d,function(a,b){$(b).hide()});$.each(b.filters,function(a,
b){var c=$(d[a]);c.text(b.name);c.attr("href","/f/"+b.name);c.show()});$(".posts").append(a);console.log("done")}};
